<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iflytek.rpa.base.dao.CParamDao">


    <select id="getAllParams" resultType="com.iflytek.rpa.base.entity.CParam">
        select * from c_param
        <where>
            <if test="processId!=null">
                and process_id = #{processId}
            </if>
            <if test="robotId!=null">
                and robot_id = #{robotId}
            </if>
            <if test="version!=null">
                and robot_version = #{version}
            </if>
            and deleted = 0
        </where>
    </select>

    <select id="countParamByName" resultType="java.lang.Long">
        select count(*)
        from c_param
        where deleted = 0
          and creator_id = #{creatorId}
          and robot_id = #{robotId}
          and robot_version = #{robotVersion}
          and process_id = #{processId}
          and var_name = #{varName}
    </select>

    <!-- 判断是否为空字符串-->
    <update id="updateParam">
        update c_param
        <set>
            <if test="varDirection!=null">
                var_direction = #{varDirection},
            </if>
            <if test="varName!=null">
                var_name = #{varName},
            </if>
            <if test="varType!=null">
                var_type = #{varType},
            </if>
            <if test="varValue!=null">
                var_value = #{varValue},
            </if>
            <if test="varDescribe!=null">
                var_describe = #{varDescribe},
            </if>
            <if test="processId!=null">
                process_id = #{processId},
            </if>
            <if test="creatorId!=null">
                creator_id=#{creatorId},
            </if>
            <if test="updaterId!=null">
                updater_id=#{updaterId},
            </if>
            <if test="createTime!=null">
                create_time=#{createTime},
            </if>
            <if test="updateTime!=null">
                update_time=#{updateTime},
            </if>
            <if test="deleted!=null">
                deleted=#{deleted},
            </if>
            <if test="robotId!=null">
                robot_id=#{robotId},
            </if>
            <if test="robotVersion!=null">
                robot_version=#{robotVersion},
            </if>
        </set>
        where id=#{id}
        and deleted = 0
    </update>

    <insert id="createParamForCurrentVersion">
        insert into c_param
        (id,
        var_direction,
        var_name,
        var_type,
        var_value,
        var_describe,
        process_id,
        creator_id,
        updater_id,
        create_time,
        update_time,
        deleted,
        robot_id,
        robot_version)
        values
        <foreach collection="entities" separator="," item="param">
            (#{param.id},
            #{param.varDirection},
            #{param.varName},
            #{param.varType},
            #{param.varValue},
            #{param.varDescribe},
            #{param.processId},
            #{param.creatorId},
            #{param.updaterId},
            now(),
            now(),
            #{param.deleted},
            #{param.robotId},
            #{param.robotVersion})
        </foreach>

    </insert>

    <select id="getSelfRobotParam" resultType="com.iflytek.rpa.base.entity.CParam">
        select *
        from c_param
        where robot_id = #{robotId}
          and process_id = #{processId}
          and robot_version = #{robotVersion}
          and deleted = 0
    </select>

    <select id="getMarketRobotId" resultType="java.lang.String">
        select rv.robot_id
        from robot_version rv
                 inner join app_market_resource amr on rv.robot_id = amr.robot_id
        where rv.version = #{appVersion}
          and amr.market_id = #{marketId}
          and amr.app_id = #{appId}
    </select>

    <select id="getDeployOriginalRobotId" resultType="java.lang.String">
        select re.app_id as robot_id
        from robot_execute re
        where re.app_version = #{appVersion}
          and re.robot_id = #{robotId}
    </select>

    <select id="getRobotVersion" resultType="java.lang.Integer">
        select version
        from robot_version
        where robot_id = #{robotId}
          and online = 1
          and deleted = 0 limit 1
    </select>

    <insert id="insertParam">
        insert into c_param
        (id,
         var_direction,
         var_name,
         var_type,
         var_value,
         var_describe,
         process_id,
         creator_id,
         updater_id,
         create_time,
         update_time,
         deleted,
         robot_id,
         robot_version)


    </insert>
    <select id="getParams" resultType="com.iflytek.rpa.base.entity.CParam">
        select *
        from c_param
        where robot_id = #{robotId}
          and creator_id = #{userId}
          and robot_version = 0
          and deleted = 0
    </select>
    <insert id="insertParamBatch">
        insert into c_param
        (id,
        var_direction,
        var_name,
        var_type,
        var_value,
        var_describe,
        process_id,
        creator_id,
        updater_id,
        create_time,
        update_time,
        deleted,
        robot_id,
        robot_version)
        values
        <foreach collection="params" separator="," item="param">
            (#{param.id},
            #{param.varDirection},
            #{param.varName},
            #{param.varType},
            #{param.varValue},
            #{param.varDescribe},
            #{param.processId},
            #{param.creatorId},
            #{param.updaterId},
            #{param.createTime},
            #{param.updateTime},
            #{param.deleted},
            #{param.robotId},
            #{param.robotVersion})
        </foreach>
    </insert>

    <select id="getParamInfoById" resultType="com.iflytek.rpa.base.entity.CParam">
        select *
        from c_param
        where deleted = 0
          and id = #{id}
    </select>

</mapper>