const e="2px solid red",t=5e3,n=["svg","g","defs","symbol","use","image","switch","a","text","tspan","textPath","foreignObject","rect","circle","ellipse","line","polyline","polygon","path","animate","animateMotion","animateTransform","set","linearGradient","radialGradient","pattern","clipPath","mask","filter","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feGaussianBlur","feImage","feMerge","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","feDistantLight","fePointLight","feSpotLight","marker","view","metadata","title","desc"];function highLight(e){let t=null;if(t)return;document.querySelectorAll(".rpa-highlight").forEach(e=>{e&&document.querySelector("html").removeChild(e)}),t=document.createElement("div"),t.className="rpa-highlight",document.querySelector("html").appendChild(t);const{width:n,height:r,left:o,top:a}=e;t.style.top=`${Math.round(a)}px`,t.style.left=`${Math.round(o)}px`,t.style.width=`${Math.round(n)}px`,t.style.height=`${Math.round(r)}px`,t.style.display="block",setTimeout(()=>{document.querySelector("html").removeChild(t)},3e3)}function sendToBackground(e){return new Promise((t,n)=>{try{chrome.runtime.sendMessage(e,e=>{t(e)})}catch(r){n(r)}})}function sendLog(e){sendToBackground({type:"log",data:e})}const r={html:"根元素",body:"主体元素",div:"块元素",span:"行元素",p:"段落",a:"链接",address:"地址",area:"热点区域",article:"文章",audio:"音频",b:"强调文本",button:"按钮",canvas:"画布",code:"代码块",col:"表格列",colgroup:"表格列组",datalist:"数据列表",details:"详细信息",dialog:"对话框",em:"强调元素",embed:"外部内容",footer:"页脚",form:"表单",frame:"嵌入文档",h1:"标题",h2:"标题",h3:"标题",h4:"标题",h5:"标题",h6:"标题",header:"页眉",hr:"主题分割",i:"术语文本",iframe:"嵌入文档",img:"图像",input:"输入",textarea:"输入域",label:"说明",li:"列表",main:"主体",mark:"突出文本",menu:"菜单",nav:"导航",ol:"有序列表",picture:"图像",progress:"进度条",select:"下拉框",summary:"摘要",table:"表格",tr:"表格行",td:"单元格",ul:"无序列表",video:"视频"},o={text:"输入框",password:"密码",checkbox:"复选框",radio:"单选框",submit:"提交按钮",reset:"重置",button:"按钮",file:"文件",hidden:"隐藏",image:"图像",email:"电子邮件",url:"网址",tel:"电话号码",number:"数字",search:"搜索",range:"范围",date:"日期",time:"时间",month:"月份",week:"周",datetime:"日期和时间",color:"颜色"},a={generateUUID(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const n=(e+16*Math.random())%16|Math.trunc(e/16);return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})},removeUrlParams:e=>e.replace(/\?.*$/,""),isNumberStartString:e=>/^\d/.test(e),isNumberString:e=>/\d/.test(e),isSpecialCharacter(e){return!!this.isNumberStartString(e)||!!/[~`!@#$%^&*()+\={}\\[\]|\:;"'<>,.?/\\（）￥！、；：“”‘’【】《》，。？、]/.test(e)},isSupportUrl:e=>/^(http|https|ftp|file):\/\/.+$/.test(e),getTag(e){const t=e.tagName.toLowerCase();if("input"===t){const t=e.getAttribute("type");return o[t]?o[t]:"输入框"}return r[t]?r[t]:"其他元素"},isDynamicAttribute(e,t){const n=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,r=/^[a-z0-9_-]{20,}$/i,o=["session-","token-","uuid-","id-","key-","time-","rand-"],a=t.toLowerCase();return"id"===e&&(n.test(t)||r.test(t))||o.some(e=>a.includes(e))},isControlCharacter:e=>/[\x00-\x1f\x7f]/.test(e),isEffectCharacter:e=>/[a-zA-Z\u4e00-\u9fa5]/.test(e),isSpaceCharacter:e=>/^\s.*|\s$/.test(e),pureText:e=>(e.replaceAll(/[\x00-\x1f\x7f]/g,""),e.startsWith(" ")&&(e=e.replace(/^\s+/,"")),e.endsWith(" ")&&(e=e.replace(/\s+$/,"")),e),generateColumnNames(e){let t="";for(;e>0;){const n=(e-1)%26;t=String.fromCharCode(65+n)+t,e=Math.floor((e-1)/26)}return t},generateColor(e){const t=["#FF5733","#33FF57","#3357FF","#FF33A1","#A133FF","#33FFF5","#F5FF33","#FF3333","#33FFA1","#8A33FF"];return t[e%t.length]},generateRandomColor:()=>`rgb(${Math.floor(256*Math.random())},${Math.floor(151*Math.random())+50},${Math.floor(256*Math.random())})`,pureObject(e,t=[]){for(const n in e)t.includes(n)||delete e[n];return e},success:(e,t="success")=>({code:"0000",data:e,msg:t}),fail:(e="failed",t="5001")=>({code:t,msg:e}),result:(e,t="success",n="0000")=>({code:e?"0000":"5001",data:e,msg:e?"success":"failed"})};function getSupportTag(e){return a.isSpecialCharacter(e)?"*":e}function getText(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName?e.value||e.getAttribute("placeholder")||"":"IMG"===e.tagName?e.getAttribute("alt")||"":e.innerText||e.textContent||""}function textAttrFromElement(e){let t=getText(e).replace(/[\x00-\x1F\x7F]/g,"");const n={text:t,attrs:{src:getAttr(e,"src"),href:getAttr(e,"href"),text:t}};for(const r in n.attrs)null===n.attrs[r]&&delete n.attrs[r];return n}function getAttr(e,t){switch(t){case"id":return e.getAttribute("id");case"class":return e.getAttribute("class");case"name":return e.getAttribute("name");case"type":return e.getAttribute("type");case"value":return e.value;case"href":return e.href;case"src":return e.src;case"title":return e.title;case"text":return function(e){return Array.from(e.childNodes).map(e=>{if(e.nodeType===Node.TEXT_NODE)return e.textContent}).find(e=>""!==e)||""}(e);case"readonly":return String(e.readOnly);default:return e.getAttribute(t)}}function getElementIndex(e){return e.parentElement?Array.from(e.parentElement.children).filter(t=>t.tagName.toLowerCase()===e.tagName.toLowerCase()).indexOf(e)+1:0}function getAllElementIndex(e){return e.parentElement?Array.from(e.parentElement.children).indexOf(e)+1:0}function getElementNthIndex(e){if(hasSameTypeSiblings(e))return e.parentElement?Array.from(e.parentElement.children).indexOf(e)+1:0}function hasSameTypeSiblings(e){return!!e.parentElement&&Array.from(e.parentElement.children).filter(t=>t.tagName.toLowerCase()===e.tagName.toLowerCase()).length>1}function hasSiblings(e){return!!e.parentElement&&Array.from(e.parentElement.children).length>1}function elementFromPoint(e,t,n){return n.elementFromPoint(e,t)}function isUniqueIdFn(e){return e&&!a.isNumberString(e)&&!a.isSpecialCharacter(e)&&1===document.querySelectorAll(`#${e}`).length}function isSvgElement(e){return"http://www.w3.org/2000/svg"===e.namespaceURI}function getXpath(e,t=!1){if(!e)return"";let n="";for(;e;){const r=e.id,o=isUniqueIdFn(r);let a=getSupportTag(e.tagName.toLowerCase()),l=getElementIndex(e),c=hasSameTypeSiblings(e);const s=isSvgElement(e);if(a=s?"*":a,l=s?getAllElementIndex(e):l,c=s?hasSiblings(e):c,!t&&o){n=`//${a}[@id="${r}"]`+n;break}if(n=l>0&&c?`/${a}[${l}]`+n:`/${a}`+n,(e=e.parentElement)&&"body"===e.tagName.toLowerCase()){n=`/${n}`;break}}return n}function getNthCssSelector(e,t=!1){if(!e)return"";let n=[];for(;e;){const r=getAttr(e,"id"),o=getSupportTag(e.tagName.toLowerCase()),a=isUniqueIdFn(r),l=getElementNthIndex(e),c=hasSameTypeSiblings(e);if("html"===o){n.unshift(o);break}if(!t&&a){n.unshift(`#${r}`);break}if(c?n.unshift(`${o}:nth-child(${l})`):n.unshift(o),(e=e.parentElement)&&"body"===e.tagName.toLowerCase())return n.join(">")}return n.join(">")}function getElementsByXpath(e,t=!1){if(!e)return null;t&&(e=e.split("/").map(e=>{const t=e.match(/\[@position\(\)=\d+\]/);if(e.includes("@position")&&!t){const t=e.match(/@position\(\)=\d+/);if(t){const n=t[0].split("=")[1];return e.replace(/\[.*\]/,`[@position()=${n}]`)}}return e}).join("/")),(e.includes("/svg[")||e.includes("/svg/"))&&(e=function(e){return e.split("/").map(e=>{if(!e||"*"===e)return e;const t=e.match(/^([^\[]+)/),r=t?t[1]:"",o=e.match(/\[(.+)\]/),a=o?o[1]:"";if(r&&"*"!==r){if(n&&n.includes(r)){if(a){const e=a.match(/^position\(\)\s*=\s*(\d+)$/);return e?`*[local-name()="${r}" and position()=${e[1]}]`:`*[local-name()="${r}" and ${a}]`}return`*[local-name()="${r}"]`}return e}return e}).filter(Boolean).join("/")}(e));const r=document.evaluate(e,document,null,XPathResult.ANY_TYPE,null);let o=r.iterateNext();const a=[];for(;o;)a.push(o),o=r.iterateNext();return a.length>0?a:null}function getElementBySelector(e,t=!1){if(!e)return null;if(t&&(e=function(e){const t=e.split(">").map(e=>e.indexOf(":nth-child")>-1?e.substring(0,e.indexOf(":nth-child")+13):e.includes(".")?e.split(".")[0]:e).join(">");return t}(e)),e.includes(">$shadow$>")){const t=function(e){const t=e.split(">$shadow$>");return queryDeepShadow(t)}(e);return t.length>0?t:null}{const t=Array.from(document.querySelectorAll(e));return t.length>0?t:null}}function queryDeepShadow(e,t=[document]){if(0===e.length)return[];const n=e[0],r=e.slice(1),o=0===r.length;let a=[];for(const l of t){const e=l.querySelectorAll(n);if(0!==e.length)if(o)a.push(...e);else for(const t of e)if(t.shadowRoot){const e=queryDeepShadow(r,[t.shadowRoot]);a.push(...e)}}return a}function getWeightedAttrs(e){const t=e.find(e=>"id"===e.name),n=e.find(e=>"type"===e.name),r=e.find(e=>"index"===e.name),o=e.find(e=>"text"===e.name),l=o&&o.value||"",c=e.find(e=>"class"===e.name);return t?(e.forEach(e=>e.checked=!1),t.checked=!0,e):o&&!a.isControlCharacter(String(l))?(o.checked=!0,e):(c&&c.checked||(n&&(n.checked=!0),r&&r.value&&(r.checked=!0)),e)}function getElementDirectory(e,t=!1){if(!e)return[];const n=[];for(;e;){const r=getAttr(e,"id"),o=isUniqueIdFn(r),l=getAttr(e,"class"),c=getAttr(e,"type");let s=getSupportTag(e.tagName.toLowerCase()),i=getElementIndex(e),u=hasSameTypeSiblings(e);const d=isSvgElement(e);s=d?"*":s,i=d?getAllElementIndex(e):i,u=d?hasSiblings(e):u;let m=[];if(isUniqueIdFn(r)&&m.push({name:"id",value:r,checked:!1,type:0}),d&&m.push({name:"local-name",value:e.tagName.toLowerCase(),checked:!0,type:0}),u&&i&&m.push({name:"index",value:i,checked:!1,type:0}),c&&m.push({name:"type",value:c,checked:!1,type:0}),l)if(l.includes(" ")){const e=l.split(" ")[0];m.push({name:"class",value:e,checked:!1,type:1})}else m.push({name:"class",value:l,checked:!1,type:0});if(0===n.length){const t=getAttr(e,"text");t&&t.length<30&&a.isEffectCharacter(t)&&(a.isControlCharacter(t)?m.push({name:"text",value:t.replace(/[\x00-\x1F\x7F]/g,""),checked:!1,type:1}):m.push({name:"text",value:t,checked:!1,type:0}))}m=getWeightedAttrs(m);const h={tag:s,checked:!0,value:s,attrs:m};if(n.unshift(h),r&&o&&!t)return n;if((e=e.parentElement)&&"body"===e.tagName.toLowerCase())return n}return n}function directoryFindElement(e,t=!1){let n="",r=[];return n=generateXPath(e,t),console.log("directoryFindElement xpath: ",n),sendToBackground({type:"log",data:`directoryFindElement generateXPath: ${n}`}),r=getElementsByXpath(n,t),r&&r.length>0?(r=function(e,t){return e.filter(e=>{const n=[];let r=e,o=t.length,a=!0;for(;o>0;)n.unshift(r),r=r.parentElement,o--;return t.forEach((e,t)=>{const r=e.attrs.find(e=>2===e.type&&e.checked);if(r){const e=String(r.value).trim();if(e){const l=n[t];if(l){const t=getAttr(l,r.name);try{new RegExp(e).test(t)||(a=!1)}catch(o){console.error(`Invalid regular expression: ${e}`,o),a=!1}}}}}),a})}(r,e),r):null}const textfn=e=>e.includes('"')?`text()=concat(${e.split('"').map((e,t,n)=>t<n.length-1?`"${e}", '"', `:`"${e}"`).join("")})`:`text()="${e}"`,conditionStr=e=>{let t;if(e.value=e.value+"",e.checked&&e.value)switch(e.name){case"index":t=`position()=${e.value}`;break;case"innertext":case"text":t=1===e.type?`contains(text(), "${e.value}")`:textfn(e.value);break;case"local-name":t=`local-name()="${e.value}"`;break;default:t=1===e.type?`contains(@${e.name}, "${e.value}")`:`@${e.name}="${e.value}"`}return t};function generateXPath(e,t=!1){t&&e.forEach(e=>{e.attrs.forEach(e=>{const t=(e.value+"").trim();"index"===e.name&&""!==t||"id"===e.name&&""!==t?e.checked=!0:e.checked=!1})});const n=e.filter(e=>e.checked).map(e=>{const t=e.attrs.filter(e=>(2!=e.type||!e.value||!e.checked)&&e.checked).map(e=>conditionStr(e)).join(" and ");return t?`${e.tag}[${t}]`:e.tag}).join("/");return n.startsWith("html")?`/${n}`:`//${n}`}function checkElements(e){if(e.length>1){!function(e){e.forEach(e=>{const t=document.createElement("div");t.className="rpa-highlight",document.querySelector("html").appendChild(t);const{width:n,height:r,left:o,top:a}=e;t.style.top=`${Math.round(a)}px`,t.style.left=`${Math.round(o)}px`,t.style.width=`${Math.round(n)}px`,t.style.height=`${Math.round(r)}px`,t.style.display="block",setTimeout(()=>{document.querySelector("html").removeChild(t)},3e3)})}(e.map(e=>e.getBoundingClientRect().toJSON()))}else{highLight(e[0].getBoundingClientRect().toJSON())}}function getAllElementsPositionInBody(e=document.body){const t=Array.from(e.querySelectorAll("*")),n=Array.from(t).filter(e=>"head"!==e.tagName.toLowerCase()&&"title"!==e.tagName.toLowerCase()&&"meta"!==e.tagName.toLowerCase()&&"script"!==e.tagName.toLowerCase()&&"style"!==e.tagName.toLowerCase()&&"link"!==e.tagName.toLowerCase()&&"none"!==(null==e?void 0:e.style.display)&&"hidden"!==(null==e?void 0:e.style.visibility)).filter(e=>e.getBoundingClientRect().width>0&&e.getBoundingClientRect().height>0),r=[];let o=[];return n.forEach(e=>{const t=e.getBoundingClientRect();if(e&&e.shadowRoot){const t=e.shadowRoot;o=getAllElementsPositionInBody(t)}r.push({element:e,...t.toJSON()})}),r.push(...o),r}function getAllFrames(){const e=document.querySelectorAll("iframe")||[],t=document.querySelectorAll("frame")||[];return Array.from(e).concat(Array.from(t))}function getWindowFrames(e=window.document){const t=getAllFrames();return Array.from(t).map(e=>({xpath:getXpath(e),src:e.src,rect:getFrameContentRect(e)}))}function getClosestElementByPoint(e){const t=elementFromPoint(e.x,e.y,document),n=document.elementsFromPoint?(r=e.x,o=e.y,document.elementsFromPoint(r,o).map(e=>{const t=e.getBoundingClientRect();return{element:e,...t.toJSON()}})):getAllElementsPositionInBody();var r,o;if(!n.length)return t;const a=n.filter(t=>t.left<=e.x&&t.top<=e.y&&t.right>=e.x&&t.bottom>=e.y);if(!a.length)return t;return a.reduce((t,n)=>Math.hypot(t.left-e.x,t.top-e.y,t.right-e.x,t.bottom-e.y)<=Math.hypot(n.left-e.x,n.top-e.y,n.right-e.x,n.bottom-e.y)?t:n).element}function findElementByPoint(e,t=!1,n=document){let r=elementFromPoint(e.x,e.y,n);return t&&n instanceof Document&&(r=getClosestElementByPoint(e)),r||null}function shadowRootElement(e,t,n="",r=[]){const{x:o,y:a}=e,l=t.elementFromPoint(o,a);if(l&&l.shadowRoot){const t=`:nth-child(${function(e){if(e.parentNode)return Array.from(e.parentNode.children).indexOf(e)+1}(l)})`;return n=n?`${n}>$shadow$>${getNthCssSelector(l)}${t}`:`${getNthCssSelector(l)}${t}`,r=r.concat(getElementDirectory(l)),shadowRootElement(e,l.shadowRoot,n,r)}return{element:l,path:n,dirs:r}}function getBoundingClientRect(e){const t=window.currentFrameInfo.iframeTransform,{scaleX:n=1,scaleY:r=1}=t,o=e.getBoundingClientRect().toJSON(),a=window.devicePixelRatio,{left:l,top:c,width:s,height:i,right:u,bottom:d,x:m,y:h}=o;return{left:Math.round(l*n*a),top:Math.round(c*r*a),width:Math.round(s*n*a)||8,height:Math.round(i*r*a)||8,right:Math.round(u*n*a),bottom:Math.round(d*r*a),x:Math.round(m*n*a),y:Math.round(h*r*a)}}function getFrameContentRect(e){const t=getBoundingClientRect(e),n=function(e){const t=window.devicePixelRatio,n=window.getComputedStyle(e);return{paddingLeft:(Number.parseInt(n.paddingLeft)||0)*t,paddingTop:(Number.parseInt(n.paddingTop)||0)*t,paddingRight:(Number.parseInt(n.paddingRight)||0)*t,paddingBottom:(Number.parseInt(n.paddingBottom)||0)*t}}(e),r=function(e){const t=window.devicePixelRatio,n=window.getComputedStyle(e);return{borderLeft:(Number.parseInt(n.borderLeftWidth)||0)*t,borderTop:(Number.parseInt(n.borderTopWidth)||0)*t,borderRight:(Number.parseInt(n.borderRightWidth)||0)*t,borderBottom:(Number.parseInt(n.borderBottomWidth)||0)*t}}(e);return{left:t.left+n.paddingLeft+r.borderLeft,top:t.top+n.paddingTop+r.borderTop,width:t.width-n.paddingLeft-n.paddingRight-r.borderLeft-r.borderRight,height:t.height-n.paddingTop-n.paddingBottom-r.borderTop-r.borderBottom,right:t.right-n.paddingRight-r.borderRight,bottom:t.bottom-n.paddingBottom-r.borderBottom,x:t.x+n.paddingLeft+r.borderLeft,y:t.y+n.paddingTop+r.borderTop}}function getIframeTransform(e){const t=window.getComputedStyle(e),n=new DOMMatrix(t.transform);return{scaleX:n.a,scaleY:n.d}}function getElementByElementInfo(e){sendToBackground({type:"log",data:`getElementByElementInfo params: ${JSON.stringify(e)}`});const{xpath:t,cssSelector:n,pathDirs:r,shadowRoot:o,checkType:a,matchTypes:l}=e,c=l&&l.includes("onlyPosition");if(o)return getElementBySelector(n,c);if("visualization"===a)return directoryFindElement(r,c);{let e=getElementsByXpath(t,c);return e&&0!==e.length||(e=getElementBySelector(n,c)),e}}function elementCountByXpath(e){const t=document.evaluate(`count(${e})`,document,null,XPathResult.NUMBER_TYPE,null);return t?t.numberValue:0}const elementCountByCssSelector=e=>(console.log("elementCountByCssSelector: ",e),getElementBySelector(e).length);function similarCssSelectorByCssSelector(e){let t="",n=0;const r=e.split(">");for(let o=r.length-1;o>=0;o--)if(r[o].indexOf(":nth-child")>-1){const e=r[o].split(":")[0];let a=r.slice(0,o).join(">")+">"+e+">"+r.slice(o+1).join(">");a=a.trim(),a=a.startsWith(">")?a.slice(1):a,a=a.endsWith(">")?a.slice(0,-1):a;const l=elementCountByCssSelector(a);l>=n&&(n=l,t=a)}return t}function similarDataBatch(e){let t=[],n={...e,value:t,value_type:e.value_type||"text"};n.rect&&delete n.rect,n.tag&&delete n.tag,n.text&&delete n.text;const r=getElementByElementInfo(e),o=r?Array.from(r):null;if(o){let e=null,r=0;for(;r<=o.length-1;){e=o[r],r+=1;const n=textAttrFromElement(e);t.push(n)}return t.every(e=>!e.text)&&(t.every(e=>e.attrs.src)&&(t.forEach(e=>{e.text=e.attrs.src}),n.value_type="src"),t.every(e=>e.attrs.href)&&(t.forEach(e=>{e.text=e.attrs.href}),n.value_type="href")),n.value=t,n}return n}function similarBatch(e){let{shadowRoot:t,xpath:n,cssSelector:r,pathDirs:o}=e;return e.xpath.includes("table")?tableColumnDataBatch(e):(t?r=similarCssSelectorByCssSelector(e.cssSelector):(n=function(e){let t="",n=0;const r=e.split("/");for(let o=r.length-1;o>=0;o--){const e=r[o].substring(r[o].indexOf("[")+1,r[o].indexOf("]"));if(/^\d+$/.test(e)){const e=r[o].split("[")[0];let a=r.slice(0,o).join("/")+"/"+e+"/"+r.slice(o+1).join("/");a=a.endsWith("/")?a.slice(0,-1):a;const l=elementCountByXpath(a);l>=n&&(n=l,t=a)}}return t}(e.xpath),r=similarCssSelectorByCssSelector(e.cssSelector),o=function(e){let t=e,n=0;return e.map(e=>({...e,attrs:e.attrs.map(e=>("innertext"===e.name&&(e.checked=!1),e))})).forEach(r=>{const o=JSON.parse(JSON.stringify(r.attrs));r.attrs.forEach(e=>{"id"===e.name?e.checked=e.checked:e.checked=!1});const a=elementCountByXpath(generateXPath(e));a>=n&&(n=a,t=JSON.parse(JSON.stringify(e))),r.attrs=o}),t}(e.pathDirs)),similarDataBatch({...e,pathDirs:o,xpath:n,cssSelector:r}))}function tableDataBatch(e){const t=function(e){const t=function(e){var t;let n=null,r=e;for(;!n&&r.parentElement;){if("table"===(null==(t=null==r?void 0:r.tagName)?void 0:t.toLowerCase())){n=r;break}r=r.parentElement}return n}(e),{maxNum:n}=getTableMaxTr(t,"tbody"),{maxTr:r,maxNum:o}=getTableMaxTr(t,"thead"),a=getTableHead(r,o);let l=t.querySelectorAll("tbody > tr");l&&0!==l.length||(l=t.querySelectorAll("tr"));let c=Array.from({length:l.length},()=>new Array(n).fill(null));l&&Array.from(l).forEach((e,t)=>{let n=0;Array.from(e.cells).forEach(e=>{for(;null!==c[t][n];)n++;for(let r=0;r<e.rowSpan;r++)for(let o=0;o<e.colSpan;o++)c[t+r]&&(c[t+r][n+o]=(e.innerText||e.textContent||"").replace(/[\u0000-\u001F\u007F]/g,""));n+=e.colSpan})});c=c.map(e=>e.map(e=>("object"==typeof e&&(e=""),e)));const s=c?c[0].length:a.length;a.length<s&&a.push(...new Array(s-a.length).fill(""));return{thead:a,tbody:c}}(getElementByParams(e)),n=function(e){const t=[];return e.thead.forEach((n,r)=>{const o={title:n||a.generateColumnNames(r+1),value:[]};e.tbody.forEach(e=>{const t=e[r]?e[r]:"";o.value.push(t)}),t.push(o)}),t}(t);let r={...e,values:n};return r.rect&&delete r.rect,r.tag&&delete r.tag,r.text&&delete r.text,r}function getTableMaxTr(e,t="tbody"){let n=null,r=0,o=e.querySelectorAll(`${t} > tr`);return o&&0!==(null==o?void 0:o.length)||"tbody"!==t||(o=e.querySelectorAll("tr")),o.forEach(e=>{let t=0;e.querySelectorAll("th, td").forEach(e=>{const n=e.getAttribute("colspan");n?t+=Number(n):t++}),t>r&&(r=t,n=e)}),{maxNum:r,maxTr:n}}function getTableHead(e,t){let n=[];if(e&&e.parentElement){const r=e.parentElement,o=Array.from({length:r.rows.length},()=>new Array(t).fill(null));r&&Array.from(r.rows).forEach((e,t)=>{let n=0;Array.from(e.cells).forEach(e=>{for(;null!==o[t][n];)n++;for(let r=0;r<e.rowSpan;r++)for(let a=0;a<e.colSpan;a++){const l=e.innerText||e.textContent||"";o[t+r]&&(o[t+r][n+a]=l.replace(/[\u0000-\u001F\u007F]/g,""))}n+=e.colSpan})}),o.forEach(e=>{var t;const r=null==(t=(e=e.filter(e=>"string"==typeof e)).filter(e=>!!e))?void 0:t.length;e.length>=n.length&&r&&(n=e)})}return n}function tableColumnDataBatch(e){const{xpath:t,cssSelector:n,pathDirs:r}=e,o=function(e){const t=e.split("/");return t.map((e,t)=>{var n;if(e.includes("tbody"))return"*";if(e.includes("tr["))return"tr";if(e.includes("td[")||e.includes("th[")){return`*[${null==(n=e.match(/\d+/))?void 0:n[0]}]`}return e}).join("/")}(t),a=function(e){let t="";const n=e.split(">").filter(e=>"tbody"!==e&&"thead"!==e);return n.map((e,t)=>{var n;if(e.includes("tr:nth-child(")){return"tr"}else if(e.includes("td:nth-child(")||e.includes("th:nth-child(")){const t=(n=e.match(/\d+/))==null?void 0:n[0];return`*:nth-child(${t})`}else{return e}}).forEach((e,n)=>{t=0===n?e:e.includes("tr")?`${t} ${e}`:`${t}>${e}`}),t}(n),l=function(e,t){var n,r,o,a;const l=t.split("/").reverse(),c=e.reverse();let s=0;for(;s<c.length;){const e=l[s];c[s].attrs.forEach(e=>{e.checked=!1});const t=null==(n=e.match(/\[(\d+)\]/))?void 0:n[1],i=null==(o=null==(r=e.match(/position\(\)=\d+/))?void 0:r[0].match(/\d+/))?void 0:o[0];(t||i)&&c[s].attrs.forEach(e=>{"index"===e.name&&(e.checked=!0,e.value=t||i)});const u=null==(a=e.match(/@id=['"](.*)['"]/))?void 0:a[1];u&&c[s].attrs.forEach(e=>{"id"===e.name&&(e.checked=!0,e.value=u)}),s+=1}return c.reverse()}(r,o);return similarDataBatch({...e,xpath:o,cssSelector:a,pathDirs:l})}function getElementByParams(e){const{xpath:t,cssSelector:n}=e;let r=function(e){return e?document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue:null}(t);return r||(r=getElementBySelector(n)?getElementBySelector(n)[0]:null),r}function elementChangeWatcher(e){const{xpath:t,cssSelector:n,matchTypes:r,watch:o,checkType:a}=e;let l={found:!1,lastMatchedNode:null,lastMatchedStep:null,notFoundStep:null,notFoundIndex:0};if("customization"===a)t&&(l=findNodeByXPathStepwise(t),!l.found&&n&&(l=function(e,t=document){const n=e.split(">").map(e=>e.trim()).filter(Boolean);let r=t,o=t instanceof Element?t:null,a=null;for(const l of n){if(!r)break;const e=r.querySelector(l);if(!e)return{found:!1,lastMatchedNode:o,lastMatchedStep:a,notFoundStep:l,notFoundIndex:n.indexOf(l)+1};r=e,o=e,a=l}return{found:!0,lastMatchedNode:o,lastMatchedStep:a,notFoundStep:null}}(n)));else{l=findNodeByXPathStepwise(generateXPath(e.pathDirs))}return l}function findNodeByXPathStepwise(e,t=document){let n=e.split("/").filter(e=>""!==e.trim()),r=t,o=t,a=null,l="";for(let c=0;c<n.length&&r;c++){l+=0!==c||n[c].startsWith("html")?`/${n[c]}`:`//${n[c]}`;const e=document.evaluate(l,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!e)return{found:!1,lastMatchedNode:o,lastMatchedStep:a,notFoundStep:l,notFoundIndex:c+1};r=e,o=e,a=l}return{found:!0,lastMatchedNode:o,lastMatchedStep:a,notFoundStep:null}}let l,c,s=0;function findElement(e,t,n){const{clientX:r,clientY:o}=e;let a=findElementByPoint({x:r,y:o},window.deepSearchEnabled,t);a||(a=e.target);let l="",c=[];if(null==a?void 0:a.shadowRoot){const e=null==a?void 0:a.shadowRoot,n=shadowRootElement({x:r,y:o},e,getNthCssSelector(a));n&&(a=n.element,l=n.path,c=n.dirs),t=e}if(a){!function(e){sendToBackground({type:"element",data:e})}(formatElementInfo(a,t,l,c)),window.frontCheckEnabled&&checkElements([a])}}function formatElementInfo(e,t,n="",r=[]){const o=getXpath(e),l=getNthCssSelector(e),c=getElementDirectory(e),s=n?`${n}>$shadow$>${l}`:l,i=r.length>0?r.concat([{tag:"$shadow$",checked:!0,value:"$shadow$",attrs:[]}],c):c,u=a.getTag(e),d=a.pureText(getText(e)).substring(0,10),m=d?a.pureText(d):"未知名称";return{xpath:o,cssSelector:s,pathDirs:i,rect:getBoundingClientRect(e),url:window.location.href,shadowRoot:t instanceof ShadowRoot,tag:u,text:m}}function messageHandler(e){const{key:t,data:n}=e.data;n&&"setIflyrpaIframe"===t&&(window.currentFrameInfo=n),"getIflyrpaIframe"===t&&tagFrame()}function tagFrame(){getAllFrames().forEach(e=>{var t;const n={iframeXpath:getXpath(e),iframeTransform:getIframeTransform(e)};null==(t=e.contentWindow)||t.postMessage({key:"setIflyrpaIframe",data:n},"*")}),window.parent!==window&&window.parent.postMessage({key:"getIflyrpaIframe"},"*")}function elementNotFoundReason(e){if(e.tabUrl!==location.href)return a.fail("当前页面与元素原页面路径不一致","5002");let t="未找到元素";const n=elementChangeWatcher(e);return n.found||(t=`元素在第${n.notFoundIndex}节点${n.notFoundStep}处发生变动`),a.fail(t,"5002")}window.frontCheckEnabled=!1,window.deepSearchEnabled=!1,window.currentFrameInfo={iframeXpath:"",iframeTransform:{scaleX:1,scaleY:1}};const i={version:"5.1.3",ele:{getElement:async(e,t=!1,n=!1)=>{const{matchTypes:r}=e,o=r&&r.includes("scrollPosition")&&!t&&!n;let a=getElementByElementInfo(e);return!a&&o&&(a=await async function(e){const t=window.innerHeight;let n=1;for(;n<=20;){window.scrollTo(window.scrollX,n*t),await new Promise(e=>setTimeout(e,1500));const r=getElementByElementInfo(e);if(r)return r;n++}return console.warn("Element lookup failed after maximum scroll attempts:",e),null}(e)),a},getDom:async e=>{const t=await i.ele.getElement(e);return t?t[0]:null},checkElement:async e=>{let t=null;try{t=await i.ele.getElement(e)}catch(n){return a.fail(n.toString(),"5003")}if(window.frontCheckEnabled&&t&&checkElements(t),t&&1===t.length){const e=getBoundingClientRect(t[0]);return a.success({rect:[e]})}if(t&&t.length>1){const e=t.map(e=>getBoundingClientRect(e));return a.success({rect:e})}return elementNotFoundReason(e)},getElementPos:async e=>{let t=null;try{t=await i.ele.getElement(e)}catch(n){return a.fail(n.toString(),"5003")}if(t&&t[0]){const e=getBoundingClientRect(t[0]);return a.success({rect:e})}return elementNotFoundReason(e)},scrollIntoView:async e=>{const{matchTypes:t}=e;let n;try{n=await i.ele.getElement(e)}catch(r){return a.fail(r.toString(),"5003")}if(n&&n[0])return n[0].scrollIntoView({behavior:"instant",block:"center"}),a.success(!0);t&&t.includes("scrollPosition");return elementNotFoundReason(e)},elementFromSelect:async e=>{const{domain:t=location.origin,url:n=location.href,shadowRoot:r}=e;let o=null;try{o=await i.ele.getElement(e)}catch(l){return a.fail(l.toString(),"5003")}if(o&&1===o.length){const l=formatElementInfo(o[0],document);return a.success([{...e,...l,domain:t,shadowRoot:r,url:n}])}if(o&&o.length>1){const l=o.map(o=>{const a=formatElementInfo(o,document);return{...e,...a,domain:t,shadowRoot:r,url:n}});return a.success(l)}return elementNotFoundReason(e)},elementIsRender:async e=>{let t=null;try{t=await i.ele.getElement(e)}catch(n){return a.fail(n.toString(),"5003")}return t?a.success(!0):a.success(!1)},elementIsTable:async e=>{let t=null;try{t=await i.ele.getElement(e)}catch(r){return a.fail(r.toString(),"5003")}if(t&&t[0]){const e="table"===(n=t[0]).tagName.toLowerCase()||null!==n.closest("table");return a.success(e)}return a.success(!1);var n},similarBatch:e=>{try{const t=similarBatch(e);return a.success(t)}catch(t){return a.fail(t.toString(),"5003")}},tableDataBatch:e=>{try{const t=tableDataBatch(e);return a.success(t)}catch(t){return a.fail(t.toString(),"5003")}},tableColumnDataBatch:e=>{try{const t=tableColumnDataBatch(e);return a.success(t)}catch(t){return a.fail(t.toString(),"5003")}},tableHeaderBatch:e=>{try{const t=function(e){let t=[];const n=(r=getElementByParams(e),r.closest("table"));var r;if(n){const{maxTr:e,maxNum:r}=getTableMaxTr(n,"thead");if(e&&(t=getTableHead(e,r)),!t.length){const{maxTr:e,maxNum:r}=getTableMaxTr(n,"tbody");t=getTableHead(e,r)}}else{const{value:n}=similarBatch(e);n&&n.length&&(t=n.map(e=>{const{text:t=""}=e;return t}))}return t}(e);return a.success(t)}catch(t){return a.fail(t.toString(),"5003")}},simalarListBatch:e=>{try{const t=function(e){const{values:t}=e;return{values:t.map((e,t)=>({...similarDataBatch(e),title:e.title||a.generateColumnNames(t+1)}))}}(e);return a.success(t)}catch(t){return a.fail(t.toString(),"5003")}},similarElement:async e=>{try{const t=await i.ele.getElement(e);return a.success({similarCount:t.length})}catch(t){return a.fail(t.toString(),"5003")}},highLightColumn:async n=>{if(s>0)return;s=t;const{produceType:r,columnIndex:o}=n,l=a.generateColor(o?o-1:0);if("table"===r){const r=await i.ele.getElement(n);if(r&&r.length>0){const n=r[0].closest("table"),c=n.querySelectorAll("tr"),i=[],u=[],d=n.querySelector(`th:nth-child(${o})`),m=d.style.border;return d&&(d.style.border=e,d.style.borderColor=l,i.push(getBoundingClientRect(d))),c.forEach(t=>{const n=t.querySelector(`td:nth-child(${o})`);if(n){const t=n.style.border;n.style.border=e,n.style.borderColor=l,u.push({border:t,td:n}),i.push(getBoundingClientRect(n))}}),setTimeout(()=>{d.style.border=m,u.forEach(e=>{e.td.style.border=e.border}),s=0},t),a.success({rect:i})}return elementNotFoundReason(n)}{const r=await i.ele.getElement(n);if(r||r.length>0){const n=[],o=[];return r.forEach(t=>{const r=t.style.border;t.style.border=e,t.style.borderColor=l,o.push({border:r,ele:t}),n.push(getBoundingClientRect(t))}),setTimeout(()=>{o.forEach(e=>{e.ele.style.border=e.border}),s=0},t),a.success({rect:n})}return elementNotFoundReason(n)}},scrollToTop:()=>(window.scrollTo(0,0),!0),getRelativeElement:async e=>{let t;const n=null==e?void 0:e.relativeOptions;try{t=await i.ele.getElement(e)}catch(l){return a.fail(l.toString(),"5003")}if(!t)return elementNotFoundReason(e);if(t.length>1)return a.fail("找到多个元素，无法唯一定位","5003");const{relativeType:r}=n;let o;try{if("child"===r&&(o=function(e,t){const{elementGetType:n}=t;return"index"===n?e.children[t.index||0]:"all"===n?Array.from(e.children):"xpath"===n?document.evaluate(`.${t.xpath}`,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue:"last"===n?e.lastElementChild:void 0}(t[0],n)),"parent"===r&&(o=t[0].parentElement),"sibling"===r&&(o=function(e,t){const{elementGetType:n}=t;return"all"===n?Array.from(e.parentElement.children):"prev"===n?e.previousElementSibling:"next"===n?e.nextElementSibling:void 0}(t[0],n)),Array.isArray(o)){const t=o.map(t=>{const n=formatElementInfo(t,document),r={...e,...n};return delete r.rect,delete r.text,delete r.relativeOptions,r});return a.success(t)}if(o){const t=formatElementInfo(o,document),n={...e,...t};return delete n.rect,delete n.text,delete n.relativeOptions,a.success(n)}return elementNotFoundReason(e)}catch(l){return a.fail(l.toString(),"5003")}},generateElement:e=>{const{type:t,value:n}=e;let r=null;try{"xpath"===t&&(r=getElementsByXpath(n)),"cssSelector"===t&&(r=getElementBySelector(n))}catch(o){return a.fail(o.toString(),"5003")}if(r&&r.length>0){const e=r.map(e=>{const t=formatElementInfo(e,document),n=a.pureObject(t,["xpath","cssSelector","url","shadowRoot"]);return Object.assign(n,{checkType:"customization",matchTypes:[]}),n}),t=e.length>1?e:e[0];return a.success(t)}return a.fail("未找到元素","5002")},clickElement:async e=>{const handleMouseEvent=({dom:e,events:t,params:n})=>{const r={bubbles:!0,cancelable:!0,view:window};n&&Object.assign(r,{clientX:n.clientX||0,clientY:n.clientY||0}),t.forEach(t=>{const n=new MouseEvent(t,r);setTimeout(()=>{e.dispatchEvent(n)},0)})},t=await i.ele.getDom(e),{buttonType:n}=e.atomConfig;if(t){try{switch(n){case"right":handleMouseEvent({dom:t,events:["mousedown","mouseup","contextmenu"]});break;case"dbclick":handleMouseEvent({dom:t,events:["mousedown","mouseup","click","mousedown","mouseup","click","dblclick"]});break;default:handleMouseEvent({dom:t,events:["mousedown","mouseup","click"]})}}catch(r){return a.fail("点击元素失败: "+r,"5003")}return a.success(!0)}return elementNotFoundReason(e)},inputElement:async e=>{const t=await i.ele.getDom(e),{inputText:n}=e.atomConfig;return t?"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName?a.fail("该元素不是原生输入元素","5003"):(t.value=n,a.success(!0)):elementNotFoundReason(e)},getElementText:async e=>{const t=await i.ele.getDom(e);if(t){if("INPUT"===t.tagName||"TEXTAREA"===t.tagName)return a.success(t.value);{const e=getText(t);return a.success(e)}}return elementNotFoundReason(e)},getElementAttrs:async e=>{const t=await i.ele.getDom(e),{operation:n,attrName:r}=e.atomConfig;if(t){let e=null;switch(n){case"0":e=getText(t);break;case"1":e=t.outerHTML;break;case"2":e=t.value||t.getAttribute("value");break;case"3":e=t.src||t.href||"";break;case"4":e=t.getAttribute(r)||"";break;case"5":e=getBoundingClientRect(t);break;case"6":if("INPUT"!==t.tagName)return a.fail("元素无选中属性","5003");e=t.checked}return a.success(e)}return elementNotFoundReason(e)},removeElementAttr:async e=>{const t=await i.ele.getDom(e),{attrName:n}=e.atomConfig;return t?(t.removeAttribute(n),a.success(!0)):elementNotFoundReason(e)},setElementAttr:async e=>{const t=await i.ele.getDom(e),{attrName:n,attrValue:r}=e.atomConfig;return t?(t.setAttribute(n,r),a.success(!0)):elementNotFoundReason(e)},getElementChecked:async e=>{const t=await i.ele.getDom(e);return t?"checkbox"===t.type||"radio"===t.type?a.success(t.checked):a.fail("该元素不是原生选框元素","5003"):elementNotFoundReason(e)},setElementChecked:async e=>{const t=await i.ele.getDom(e),{checked:n}=e.atomConfig;return t?"checkbox"===t.type||"radio"===t.type?(t.checked=n,a.success(!0)):a.fail("该元素不是原生选框元素","5003"):elementNotFoundReason(e)},getElementSelected:async e=>{const t=await i.ele.getDom(e),{option:n}=e.atomConfig;if(t){if("SELECT"!==t.tagName)return a.fail("该元素不是原生下拉框元素","5003");if("selected"===n){const e=Array.from(t.selectedOptions).map(e=>({label:e.label||"",value:e.value||""}));return a.success(e)}{const e=Array.from(t.options).map(e=>({label:e.label||"",value:e.value||""}));return a.success(e)}}return elementNotFoundReason(e)},setElementSelected:async e=>{const t=await i.ele.getDom(e),{value:n,pattern:r,indexValue:o}=e.atomConfig;if(t){if("SELECT"!==t.tagName)return a.fail("该元素不是原生下拉框元素","5003");for(var l=t.options,c=0;c<l.length;c++)"contains"===r&&l[c].label.indexOf(n)>-1&&(t.value=l[c].value),"equal"===r&&l[c].label===n&&(t.value=l[c].value),"index"===r&&c+1===o&&(t.value=l[c].value);return a.success(!0)}return elementNotFoundReason(e)},getTableData:async e=>{const t=await i.ele.getDom(e);if(t){const e=function(e){const t=function(e){var t;let n=null,r=e;for(;!n&&r.parentNode;){if("table"===(null==(t=null==r?void 0:r.tagName)?void 0:t.toLowerCase())){n=r;break}r=r.parentNode}return n}(e);if(!t)return a.fail("不是表格元素","5003");const{maxTr:n,maxNum:r}=getTableMaxTr2(t,"tbody");if(!n)return a.fail("表格元素获取失败","5003");const{maxTr:o,maxNum:l}=getTableMaxTr2(t,"thead");let c=function(e,t){let n=[];if(e&&e.parentNode){const r=null==e?void 0:e.parentNode,o=Array.from({length:r.rows.length},()=>new Array(t).fill(null));r&&Array.from(r.rows).forEach((e,t)=>{let n=0;Array.from(e.cells).forEach(e=>{for(;null!==o[t][n];)n++;for(let r=0;r<e.rowSpan;r++)for(let a=0;a<e.colSpan;a++){const l=e.innerText||e.textContent||"";o[t+r]&&(o[t+r][n+a]=l.replace(/[\u0000-\u001F\u007F]/g,""))}n+=e.colSpan})}),o.forEach(e=>{var t;const r=null==(t=(e=e.filter(e=>"string"==typeof e)).filter(e=>!!e))?void 0:t.length;e.length>=n.length&&r&&(n=e)})}return n}(o,l),s=t.querySelectorAll("tbody > tr");s&&0!==s.length||(s=t.querySelectorAll("tr"));let i=Array.from({length:s.length},()=>new Array(r).fill(null));s&&Array.from(s).forEach((e,t)=>{let n=0;Array.from(e.cells).forEach(e=>{for(;null!==i[t][n];)n++;for(let r=0;r<e.rowSpan;r++)for(let o=0;o<e.colSpan;o++)i[t+r]&&(i[t+r][n+o]=(e.innerText||e.textContent||"").replace(/[\u0000-\u001F\u007F]/g,""));n+=e.colSpan})});i=i.map(e=>e.map(e=>("object"==typeof e&&(e=""),e)));var u=Math.max(...i.map(e=>e.length));u>c.length&&(c=c.concat(new Array(u-c.length).fill("")));return{thead:c,tbody:i}}(t);return a.success(e)}return elementNotFoundReason(e);function getTableMaxTr2(e,t="tbody"){let n=null,r=0,o=e.querySelectorAll(`${t} > tr`);return o&&0!==(null==o?void 0:o.length)||"tbody"!==t||(o=e.querySelectorAll("tr")),o.forEach(e=>{let t=0;e.querySelectorAll("th, td").forEach(e=>{const n=e.getAttribute("colspan");n?t+=Number(n):t++}),t>r&&(r=t,n=e)}),{maxNum:r,maxTr:n}}},scrollWindow:async e=>{let t=window;if((e.xpath||e.cssSelector||e.pathDirs)&&(t=await i.ele.getDom(e)),!t)return elementNotFoundReason(e);const{scrollTo:n,scrollAxis:r,scrollX:o=0,scrollY:l=0,scrollBehavior:c="instant"}=e.atomConfig;return"top"===n&&t.scrollTo({top:0,behavior:c}),"left"===n&&t.scrollTo({left:0,behavior:c}),"bottom"===n&&t.scrollTo({top:99999,behavior:c}),"right"===n&&t.scrollTo({left:99999,behavior:c}),"custom"===n&&"x"===r&&t.scrollTo({left:o,behavior:c}),"custom"===n&&"y"===r&&t.scrollTo({top:l,behavior:c}),a.success(!0)}},code:{runJS:e=>{try{const{code:t}=e,n=new Function(t)();return a.success(n)}catch(t){const e="runJS "+t.toString();return sendLog(e),a.fail(e,"5003")}}},frame:{getFrames:()=>{const e=getWindowFrames();return a.success(e)},getFramePosition(e){const{url:t,iframeXpath:n}=e,r=getWindowFrames(),o=n?r.find(e=>e.xpath===n):r.find(e=>e.src.includes(t)||t.includes(e.src));return o?o.rect:{x:0,y:0,width:0,height:0,left:0,top:0,right:0,bottom:0}},getFrameInfo:()=>(tagFrame(),window.currentFrameInfo),getIframeElement:e=>{const{x:t,y:n}=e,r=window.devicePixelRatio,o=t/r,a=n/r,l=document.elementFromPoint(o,a);if(l){const{left:e,top:t}=l.getBoundingClientRect(),n=parseInt(window.getComputedStyle(l).borderLeftWidth),c=parseInt(window.getComputedStyle(l).borderTopWidth),s=parseInt(window.getComputedStyle(l).paddingLeft),i=parseInt(window.getComputedStyle(l).paddingTop),u={x:(o-e-n-s)*r,y:(a-t-c-i)*r};let d=null;"IFRAME"!==l.tagName&&"FRAME"!==l.tagName||(d={x:(e+n+s)*r,y:(t+c+i)*r},tagFrame());return{...formatElementInfo(l,document),nextPos:u,iframeContentRect:d}}},stopLoad:()=>(window.stop(),!0)},page:{fullPageRect:()=>{let e="BackCompat"===document.compatMode?document.body:document.documentElement,t=Math.pow(2,13),n=Math.floor(t/window.devicePixelRatio);return{x:0,y:0,width:Math.min(e.scrollWidth,n),height:Math.min(e.scrollHeight,n)}},getDPR:()=>({dpr:window.devicePixelRatio})}};function executeHandler(e,t,n=!0){return i.ele[e]?i.ele[e](t):i.code[e]?i.code[e](t):i.frame[e]?i.frame[e](t):i.page[e]?i.page[e](t):a.fail("暂不支持该功能","5004")}window.handle=async function(e){sendLog(`handle params: ${JSON.stringify(e)}`);const{key:t,data:n}=e;return await executeHandler(t,n,!0)},window.handleSync=function(e){sendLog(`handleSync params: ${JSON.stringify(e)}`);const{key:t,data:n}=e;return executeHandler(t,n,!1)},window.moveListener=function(e,t,n){l&&clearTimeout(l),c&&clearTimeout(c),l=setTimeout(()=>{findElement(e,t),clearTimeout(l),c=setTimeout(()=>{window.deepSearchEnabled=!0,findElement(e,t),window.deepSearchEnabled=!1,clearTimeout(c)},5e3)},200)},window.removeEventListener("message",messageHandler),window.addEventListener("message",messageHandler),window.RpaExtGetElement=e=>{sendLog(`RpaExtGetElement data: ${JSON.stringify(e)}`);try{const t=getElementByElementInfo(e);return t?t[0]:null}catch(t){throw new Error(t.toString())}},tagFrame();
